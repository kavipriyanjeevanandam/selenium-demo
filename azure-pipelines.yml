
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml
pool: Elanthamilan

resources:
  webhooks:
    - webhook: azdevops          ### Webhook alias
      connection: azdevops

steps:
- task: AzurePowerShell@5
  inputs:
    azureSubscription: 'keyvault-fl'
    ScriptType: 'InlineScript'
    Inline: |
      $jsonAlert =  ${{ parameters.azdevops.data }}
      $vmResourceId = $jsonAlert.essentials.alertTargetIDs[0]
      $vmName = ($vmResourceId -split '/')[-1]
      $resourceGroup = ($vmResourceId -split '/')[4]
      Stop-AzVM -ResourceGroupName $resourceGroup -Name $vmName -Force
    azurePowerShellVersion: 'LatestVersion'


