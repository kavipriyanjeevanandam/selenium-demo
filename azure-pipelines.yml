
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml
pool: Elanthamilan

resources:
  webhooks:
    - webhook: azdevops          ### Webhook alias
      connection: azdevops

steps:
- task: AzurePowerShell@5
  inputs:
    azureSubscription: 'keyvault-fl'
    ScriptType: 'InlineScript'
    Inline: |
      $alertPayload = ConvertFrom-Json -InputObject $env:AZURE_PIPELINE_WEBHOOK_PAYLOAD
      $vmResourceId = $alertPayload.data.essentials.alertTargetIDs[0]
      $vmName = ($vmResourceId -split '/')[-1]
      $resourceGroup = ($vmResourceId -split '/')[4]
      Write-Host "VM Name: $vmName"
      Write-Host "Resource Group: $resourceGroup"
    azurePowerShellVersion: 'LatestVersion'


